<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <head>
	<meta charset="utf-8">

<meta name="description" content="First published here for my intern at UCL-ISMB-CATH. [markdown] Brief: Having the privilege of joining Orengo's group as a summer student, I feel urged to …">
<meta name="keywords" content="program,english,python">
<meta name="author" content="F. Geng">
<meta name="robots" content="index,follow">


<!-- OpenGraph -->
<meta property="og:property" content="en">
<meta property="og:title" content="Writing Python modularly // Python模块化初步">
<meta property="og:type" content="article">
<meta property="og:description" content="First published here for my intern at UCL-ISMB-CATH. [markdown] Brief: Having the privilege of joining Orengo's group as a summer student, I feel urged to …">
<meta property="article:published_time" content="2017-06-30">
<meta property="article:tag" content="program">
<meta property="article:tag" content="english">
<meta property="article:tag" content="python">
<meta property="article:section" content="program">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Writing Python modularly // Python模块化初步</title>
	<script type="text/javascript" src="http://www.newflaw.com/blog/theme/js/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="http://www.newflaw.com/blog/theme/js/bootstrap.js"></script>

	<!-- Bootstrap CSS  -->
	<link rel="stylesheet" href="http://www.newflaw.com/blog/theme/css/bootstrap.css"/>
	<link rel="stylesheet" href="http://www.newflaw.com/blog/theme/css/responsive.css"/>
	
	<!-- Generated favicons markup -->
	<link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicons/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicons/apple-touch-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicons/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicons/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicons/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicons/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicons/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon-180x180.png">
	<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/assets/images/favicons/android-chrome-192x192.png" sizes="192x192">
	<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-96x96.png" sizes="96x96">
	<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16">
	<link rel="manifest" href="/assets/images/favicons/manifest.json">
	<link rel="shortcut icon" href="/assets/images/favicons/favicon.ico">
	<meta name="msapplication-TileColor" content="#2b5797">
	<meta name="msapplication-TileImage" content="/assets/images/favicons/mstile-144x144.png">
	<meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">
	<!-- LESS generated css for Nuja theme -->
	<link rel="stylesheet" href="http://www.newflaw.com/blog/theme/css/NujaStructure.css"/>
	<!-- Highlight -->
	<link rel="stylesheet" href="http://www.newflaw.com/blog/theme/css/pygment.css"/>

	<link href="http://fonts.googleapis.com/css?family=Droid+Serif" rel="stylesheet" type="text/css">
	<link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
	<!--[if IE]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>



	<!-- setup feeds and third-party services -->
	<link href="http://www.newflaw.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Newflaw Atom Feed" />
	<!-- to clean up later for the new theme -->
	<script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-968141-17', 'auto');
ga('send', 'pageview');

	</script>
	<meta name="google-site-verification" content="4TETrzpAoVPu2-VrTpOxQJFmmynS9VzPq_boE45VKa8" />
	<meta name="msvalidate.01" content="E2790C576E7623BE2F59AC965B48361D" />
    </head>
    <body>

	<div class="container">
	    <div class="header-container">
		<header>
		    <a href="http://www.newflaw.com/blog/">
			<h4>Newflaw <span>Nature is never flawless</span></h4>		    </a>

		    <nav>
			<ul>
			    <li><a href="http://www.newflaw.com/blog/">Home</a></li>
			    <li><a href="http://www.newflaw.com/blog/about-me/">About Me</a></li>

			    <li><a href="http://www.newflaw.com/blog/archives.html">Archive</a></li>

			</ul>
		    </nav>
		</header>


	    </div>
	    <div class="clearfix"></div>
	    <div class="row">
		<div class="span9">

		    <div class="span10">


<div class="row">
	
	
    <div class="span9 alpha">
	<div class="entry-container ">

	    <article  class="entry hentry" >
		<header>
		    <a href="http://www.newflaw.com/blog/articles/program/writing-python-modularly-pythonmo-kuai-hua-chu-bu/" rel="bookmark" title="permalink for Writing Python modularly // Python模块化初步" ><h2 class="entry-title">Writing Python modularly // Python模块化初步</h2></a>
		    <div class="author-details vcard">

			by <a  class="url fn" href="http://www.newflaw.com/blog/author/f-geng/">F. Geng</a>  
		    . Category: <a href="http://www.newflaw.com/blog/category/program.html">program</a>. 
			    Tags: 
 <a href="http://www.newflaw.com/blog/tag/program/" title="Browse tag: program" rel="tag">program</a>,  <a href="http://www.newflaw.com/blog/tag/english/" title="Browse tag: english" rel="tag">english</a>,  <a href="http://www.newflaw.com/blog/tag/python/" title="Browse tag: python" rel="tag">python</a>		    <br> Last Updated: June 30, 2017
 		</div>
		</header>
		<div class="entry-content">
		<p>First published <a href="http://orengogroup.info/?p=401">here</a> for my intern at UCL-ISMB-CATH.
[markdown]</p>
<h4>Brief:</h4>
<p>Having the privilege of joining Orengo's group as a summer student, I feel urged to improve my coding as well as documentation skills. Thus I intend to log my coding and thinking in a series of blog posts, on a weekly basis.</p>
<p>Today's blog post will cover some basics of organising Python code, in the hope of easing future maintenance. We will go through:</p>
<!--more-->

<ol>
<li>How to import python modules.</li>
<li>Comparing alternative implementations</li>
<li>How to write importable python modules.</li>
<li>Simplistic approach "<code>.py</code>"</li>
<li>How to structure your python modules.</li>
<li>How does import work anyway?</li>
</ol>
<h4>1. How to import python modules.</h4>
<p>In Python, importing a module is common and useful. For example, "<code>numpy</code>" is a widespread module with handy matrix operations. If numpy is not installed on your machine. Try "<code>pip install numpy</code>".</p>
<p>For example, in python do:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">rd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random number&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is generated&#39;</span><span class="p">)</span>
</pre></div>


<p>You can also use your own alias when importing a module</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random number&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is generated&#39;</span><span class="p">)</span>
</pre></div>


<p>You can even import a submodule on its own</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">random</span>

<span class="c1">#### Which is the right one to do now?</span>
<span class="n">rd</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">rd</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random number&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is generated&#39;</span><span class="p">)</span>
</pre></div>


<p>Question 1:</p>
<div class="highlight"><pre><span></span><span class="c1">#### Modify the import statement to make the code work</span>

<span class="c1"># import numpy.random as random</span>

<span class="n">rd</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random number&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is generated&#39;</span><span class="p">)</span>
</pre></div>


<p>You can also do "<code>help(np)</code>" or "<code>help(np.random)</code>" to read the manual, which would hopefully tell you about the submodules available for call. The above should remind you of how to import a installed module. Note I did not talk about what "<code>import</code>" does exactly, but this won't affect your usage of the command -- you know how it should look like.</p>
<p>Now, developers not only need to import installed modules, but also to actually write an importable module. To make it in context, we need a toy example. My favourite toy is cellular automata so I will just outline it here.</p>
<p>Imagine you got a circular peptide chain of a fixed length, say 12 amino-acid(aa) residues(res). At every residue position, it can have one of the 20 universally-encoded amino acid. Now this protein has some strange behaviour. Every time it is passed from parent to progeny, its sequence change in a deterministic way. Each residue would look at the residue adjacent to it, and decide what aa it become in the next round. We call this process one round of evolution.</p>
<p>There are 20*20*20 = 8000 possible permutations that could happen, and we need to specify the resultant residue from each of the 8000 permutations. First let's assume the rule is simple, every of them become an Ala (aa_id:1)</p>
<p>Let's create a python script "<code>main.py</code>" with the following commands.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1">### We fill the rule array with loads of 1&#39;s</span>
<span class="n">rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="n">new</span> <span class="o">=</span> <span class="n">old</span><span class="p">[:];</span> <span class="c1">## Create a independent copy.</span>
<span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old</span><span class="p">):</span>
    <span class="n">i_lef</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">### numpy handle -1th entry swiftly as expected</span>
    <span class="n">i_rig</span> <span class="o">=</span> <span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">%</span> <span class="n">l</span> <span class="c1">## We do not want to access 13th entry from a 12-entry array.</span>

    <span class="c1"># res = old[ i ]; ### from definition</span>
    <span class="n">res_lef</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span> <span class="n">i_lef</span> <span class="p">];</span>
    <span class="n">res_rig</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span> <span class="n">i_rig</span> <span class="p">];</span>

    <span class="c1">### Look up the rule array</span>
    <span class="n">new</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span> <span class="p">[</span> <span class="n">res_lef</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">res_rig</span> <span class="p">];</span>

<span class="nb">print</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</pre></div>


<p>Due to the simplistic rule, we would expect a simple result.</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<p>Okay this code is functional. But we feel the updating process is a bit lengthy. It'd be great if we can achieve some condensation, and that's where modules come in.</p>
<h4>2. How to write importable python modules.</h4>
<h5>Before making a module, make a function first:</h5>
<p>Let's forget about modules and functions for a moment, just imagine you could tell python to do:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1">### We fill the rule array with loads of 1&#39;s</span>
<span class="n">rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="c1">#### One line looks much simpler</span>
<span class="n">new</span> <span class="o">=</span> <span class="n">evolve</span><span class="p">(</span> <span class="n">old</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span> <span class="c1">### Magic happens</span>

<span class="nb">print</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</pre></div>


<p>This one-liner will become handy if we'd like to see the result after 1000 rounds, it will just be</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1">### We fill the rule array with loads of 1&#39;s, and use a predefined starting sequence</span>
<span class="n">rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="k">for</span> <span class="n">evocount</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1000</span> <span class="p">):</span>
    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">evolve</span><span class="p">(</span> <span class="n">seq</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">new_seq</span>

<span class="c1">### both should work</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_seq</span><span class="p">)</span>
</pre></div>


<p>This code obviously is not functional yet. Running it throws "<code>NameError: name 'evolve' is not defined</code>", which makes sense, for we did not define "<code>evolve</code>" anywhere at all. Define a function in python is straight forward. Let's define this magic called "<code>evolve()</code>":</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span> <span class="n">old</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">old</span><span class="p">[:];</span> <span class="c1">## Create a independent copy. </span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old</span><span class="p">):</span>
        <span class="n">i_lef</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">### numpy handle -1th entry swiftly as expected</span>
        <span class="n">i_rig</span> <span class="o">=</span> <span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">%</span> <span class="n">l</span> <span class="c1">## We do not want to access 13th entry from a 12-entry array.</span>

        <span class="c1"># res = old[ i ]; ### from definition</span>
        <span class="n">res_lef</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span> <span class="n">i_lef</span> <span class="p">];</span>
        <span class="n">res_rig</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span> <span class="n">i_rig</span> <span class="p">];</span>

        <span class="c1">### Look up the rule array</span>
        <span class="n">new</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span> <span class="p">[</span> <span class="n">res_lef</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">res_rig</span>  <span class="p">];</span>
    <span class="k">return</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="c1">### we return the output of the function to global namespace. </span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="k">for</span> <span class="n">evocount</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1000</span> <span class="p">):</span>
    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">evolve</span><span class="p">(</span> <span class="n">seq</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">new_seq</span>

<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</pre></div>


<p>Swift! The error was no more, at the expense of introducing a "<code>def</code>" statement. This "<code>def</code>" spans 14 lines, which is Okay, but sometimes it can get very lengthy and it destroys the effect of our simplification. Thus it'd be good to replace the "<code>def</code>" even further with "<code>import</code>".</p>
<h5>So let's do some import magic</h5>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">evolve</span> <span class="c1">#### Magic happens</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="k">for</span> <span class="n">evocount</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1000</span> <span class="p">):</span>
    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">evolve</span><span class="p">(</span> <span class="n">seq</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">new_seq</span>

<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</pre></div>


<p>As the module "<code>evolve</code>" is not defined yet (no magic yet), we'd expect "<code>ImportError: No module named evolve</code>". So, how on earth do we pack "<code>def</code>" into a module? A python module is essentially a "<code>.py</code>" script or a <strong>directory</strong> containing "<code>.py</code>" scripts.</p>
<p>To create a "<code>evolve</code>" module, let's make a "<code>evolve.py</code>" under the <strong>same</strong> directory as "<code>main.py</code>" created earlier.</p>
<p>"<code>evolve.py</code>"</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span> <span class="n">old</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
<span class="n">new</span> <span class="o">=</span> <span class="n">old</span><span class="p">[:];</span> <span class="c1">## Create a independent copy.</span>
<span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old</span><span class="p">):</span>
    <span class="n">i_lef</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">### numpy handle -1th entry swiftly as expected</span>
    <span class="n">i_rig</span> <span class="o">=</span> <span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">%</span> <span class="n">l</span> <span class="c1">## We do not want to access 13th entry from a 12-entry array.</span>

<span class="c1"># res = old[ i ]; ### from definition</span>
<span class="n">res_lef</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span> <span class="n">i_lef</span> <span class="p">];</span>
<span class="n">res_rig</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span> <span class="n">i_rig</span> <span class="p">];</span>

<span class="c1">### Look up the rule array</span>
<span class="n">new</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span> <span class="p">[</span> <span class="n">res_lef</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">res_rig</span> <span class="p">];</span>
<span class="k">return</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="c1">### return the output of the function to global namespace</span>
</pre></div>


<p>Remember to always save your changes in text editor!</p>
<p>Let's run "<code>main.py</code>" again. Unfortunately, it still throws an error. "<code>TypeError: 'module' object is not callable</code>" If you look at the line reported, you should find the "<code>evolve( seq, rule)</code>" statement in "<code>main.py</code>". Generally, to "call" "<code>foo</code>", just means running "<code>foo()</code>".</p>
<p>If you remember <strong>Question 1</strong> from earlier with "<code>random.random()</code>", you should come up with "<code>evolve.evolve( seq, rule)</code>" as a solution. To make it clearer, let's change the name of "<code>evolve.py</code>" to "<code>lib.py</code>". Correspondingly "<code>main.py</code>" should change to:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">lib</span>
<span class="c1"># from lib import evolve #### Alternative solution</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">ones</span><span class="p">([</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="k">for</span> <span class="n">evocount</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1000</span> <span class="p">):</span>
    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span> <span class="n">seq</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
    <span class="c1"># new_seq = evolve( seq, rule) #### Alternative solution</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">new_seq</span>

<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</pre></div>


<p>Generally, it is good practice to keep the module name different from the submodules (like "<code>def</code>" within the script) contained within. e.g.: Do not place "<code>def evolve():</code>" in "<code>evolve.py</code>" to avoid confusing statement like "<code>evolve.evolve()</code>".</p>
<h5>3. Organising your modules</h5>
<p>At the moment everything is under the same directory "<code>.</code>" . However as your programme get bigger, more and more "<code>.py</code>" will be popping up, when it would be useful to separate modules for different purposes into different folders, so that you don't go through: "Okay I am gonna run a test suite, but which "<code>.py</code>" files should I run? Hmm let me have a browse..."</p>
<p>Too keep things simple, lets assign some names. We don't really care what the root directory "<code>.</code>" is called , but let's call it "<code>toy</code>". So at the moment there are two files "<code>toy/main.py</code>" and "<code>toy/lib.py</code>".</p>
<div class="highlight"><pre><span></span><span class="err">.</span>
<span class="err">├── lib.py</span>
<span class="err">└── main.py</span>
</pre></div>


<p>Conventionally, we store all easily importable modules into a directory "<code>lib/</code>" instead of a script. So let's do</p>
<div class="highlight"><pre><span></span><span class="err">mkdir lib</span>
<span class="err">mv lib.py lib/libA.py</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">.</span>
<span class="err">├── lib</span>
<span class="err">│   └── libA.py</span>
<span class="err">└── main.py</span>
</pre></div>


<p>Runing "<code>main.py</code>" throws "<code>ImportError: No module named lib</code>". Python does not automatically recognise directory as importable. We need to flag a directory by placing "__init__.py" under it. Just do</p>
<div class="highlight"><pre><span></span><span class="err">touch lib/__init__;.py</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">.</span>
<span class="err">├── lib</span>
<span class="err">│   ├── __init__.py</span>
<span class="err">│   └── libA.py</span>
<span class="err">└── main.py</span>
</pre></div>


<p>Now "<code>main.py</code>" throws "<code>ImportError: cannot import name evolve</code>". Yah yah, nothing in "<code>lib/</code>" has the name "<code>evolve</code>". We need to update the "<code>main.py</code>" with "<code>from lib.libA import evolve</code>". Note "<code>import lib.libA.evolve</code>" would not work because "<code>evolve</code>" is defined as "<code>def</code>" and not a script "<code>.py</code>".</p>
<p>Cool, now we even have a decent "lib/" folder! Another common directory in Test-Driven-Development (TDD) is "tests/". Let's create some look-alike structure with `</p>
<div class="highlight"><pre><span></span><span class="err">mkdir tests</span>
<span class="err">cp main.py tests/test1.py</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">.</span>
<span class="err">├── lib</span>
<span class="err">│   ├── __init__.py</span>
<span class="err">│   └── libA.py</span>
<span class="err">├── main.py</span>
<span class="err">└── tests</span>
<span class="err">└── test1.py</span>
</pre></div>


<p>Now in "<code>test1.py</code>", can we still import normally? Running "<code>tests1.py</code>" give "<code>ImportError: No module named lib.libA</code>". By default, "<code>import</code>" only search the directory where the running script exists, and then any directory on env variable $PYTHONPATH, which itself is default to $PATH if unset.</p>
<p>Remember the "<code>main.py</code>" and "<code>test1.py</code>" are essentially identical, except in different directories. There are many possible fiexes here:
1. include the root directory ("<code>toy/</code>") on $PATH, allowing "<code>test1.py</code>" to also access it.
2. Adding a statement in "<code>test1.py</code>" to alter the $PATH variable on the fly
3. Some other module-based approach (still exploring)</p>
<p>Approach 2: OTF change to $PATH. See "<code>branch:orig2_tests_opt2</code>"
Let's add the following to "<code>test1.py</code>"</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
</pre></div>


<p>Great! Above concludes my initial effort in organising my Python code, and hopefully reveal the magic behind "<code>import</code>" a little bit. I believe every python user is familiar with "<code>pip install</code>", and the frustration where this command fails (Or a worse case: it appears successful, but still shouting up "<code>ImportError</code>"). After understanding importing, installing a module boils down to place the importable modules on a suitable $PATH. And if your $PATH don't contain your installed module, it is expected to fail. There is also other issue like syntax difference between python2 and python3, but I hope the gist is clear.</p>
<p>Feng Geng<br />
Summer Student<br />
ISMB,UCL</p>
<p>[/markdown]</p>
			
		 </div>
	    </article>

	    <!--
	    in case any image breaks the theme
	    i was going to use :after but it didn't quite work for me, maybe next time-->
	    <div class="clearfix"></div>



	</div>
    </div>
</div>


	    
<div class="row">
    <div class="alpha span9">
	<ul>
	    <li>Disqus Note: Please do not make personal attacks of any kind.</li>
	</ul>
<div id="disqus_thread"></div>
    <script type="text/javascript">
	var disqus_shortname = 'newflaw';
	var disqus_identier = 'articles/program/writing-python-modularly-pythonmo-kuai-hua-chu-bu/';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	    dsq.setAttribute('data-timestamp', +new Date());
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div></div>
		    </div>
		</div>
<!-- Sidebar -->
<aside class="span3  hidden-phone hidden-tablet">

    <div class="widget-external-links widget">
	<h3 class="widget-header">External Links</h3>
	<div class="widget-content">
	    <ul class="widget-list">
		<li class="widget-list-item"><a href="https://stackoverflow.com/users/8083313/shouldsee">Stackoverflow</a></li>		<li class="widget-list-item"><a href="http://github.com/shouldsee"><img width="16" height="16" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"></img> Github</a></li> 	    </ul>
	</div>
    </div>
    <div class="widget-external-links widget">
        <h3 class="widget-header">Recent Articles</h3>
	<div class="widget-content">
	    <ul class="widget-list">
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/thoughts/feng-cheng-ji-shi-zha-zha/" title="Read: 风城纪事·渣渣">风城纪事·渣渣</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/thoughts/doremido-chi-lai-mi-chi/" title="Read: DoReMiDo // 哆来咪哆">DoReMiDo // 哆来咪哆</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/thoughts/feng-cheng-ji-shi-ou-yu/" title="Read: 风城纪事·偶遇">风城纪事·偶遇</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/program/how-to-fail-your-deadline-starting-learning-mysql-thinking-you-can-master-it-in-one-day-xiang-chao-shi-wan-cheng-ren-wu-lai-xue-mysqljiu-hao/" title="Read: How to fail your deadline? - Starting learning MySQL thinking you can master it in one day! // 想超时完成任务？来学MySQL就好！">How to fail your deadline? - Starting learning MySQL thinking you can master it in one day! // 想超时完成任务？来学MySQL就好！</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/story/feng-cheng-ji-shi-an-hei/" title="Read: 风城纪事·暗黑">风城纪事·暗黑</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/thoughts/ruin-your-childhood-memory-from-digimons-to-colonialism-hui-tong-nian-zhi-hou-zhi-min-shu-ma-bao-bei/" title="Read: Ruin your childhood memory -- From Digimons to colonialism // 毁童年之后殖民数码宝贝">Ruin your childhood memory -- From Digimons to colonialism // 毁童年之后殖民数码宝贝</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/thoughts/feng-cheng-ji-shi-qu-dai/" title="Read: 风城纪事·取代">风城纪事·取代</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/thoughts/gui-ji-qian-zheng-shang/" title="Read: 轨迹，签证，熵">轨迹，签证，熵</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/program/writing-python-modularly-pythonmo-kuai-hua-chu-bu/" title="Read: Writing Python modularly // Python模块化初步">Writing Python modularly // Python模块化初步</a></li>
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/articles/thoughts/feng-cheng-ji-shi-pian-jian/" title="Read: 风城纪事·偏见">风城纪事·偏见</a></li>
	    </ul>
	</div>
    </div>
    <div class="widget-archive-category widget">
	<h3 class="widget-header">Category</h3>
	<div class="widget-content">
	    <ul class="widget-list">
		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/category/list.html">list.<span>1</span></a></li>

		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/category/maths.html">maths.<span>7</span></a></li>

		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/category/misc.html">misc.<span>1</span></a></li>

		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/category/program.html">program.<span>2</span></a></li>

		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/category/story.html">story.<span>1</span></a></li>

		<li class="widget-list-item"><a href="http://www.newflaw.com/blog/category/thoughts.html">thoughts.<span>11</span></a></li>

	    </ul>
	</div>
    </div>
    <div class="widget">
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- dgzen he -->
	<ins class="adsbygoogle"
	    style="display:inline-block;width:300px;height:600px"
	    data-ad-client="ca-pub-4442880234515975"
	    data-ad-slot="1240455063"></ins>
	<script>
	    (adsbygoogle = window.adsbygoogle || []).push({});
	</script>
    </script>
</div>
		</aside>
	    </div>
	    <!--footer-->
	    <div class="row">
		<div class="span12">
		    <footer>
			<p>Powered by <a href="http://getpelican.org">Pelican</a>.</p>
			<p><a href="">Nuja theme</a> designed by <a rel="bookmark" href="http://dgzen.pw">DGZen</a>.</p>
		    </footer>
		</div>
	    </div>
	</div>


    </body>
</html>